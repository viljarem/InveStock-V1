name: üîÑ Keep Streamlit App Alive

on:
  schedule:
    # Pinger appen daglig for √• forhindre at den sovner
    # Streamlit Cloud free tier sovner etter ~7 dager uten bes√∏k
    - cron: '0 12 * * *'  # Kl 13:00 norsk tid (vintertid) / 14:00 (sommertid)
  
  workflow_dispatch:  # Manuell kj√∏ring

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: üèì Ping Streamlit App
      env:
        APP_URL: ${{ secrets.STREAMLIT_APP_URL }}
      run: |
        if [ -z "$APP_URL" ]; then
          echo "‚ö†Ô∏è  STREAMLIT_APP_URL secret er ikke satt!"
          echo "G√• til repo Settings ‚Üí Secrets ‚Üí New secret"
          echo "Navn: STREAMLIT_APP_URL"
          echo "Verdi: https://din-app.streamlit.app"
          exit 1
        fi
        
        echo "üîÑ Pinger $APP_URL..."
        
        # F√∏rste fors√∏k ‚Äî appen kan v√¶re i sovemodus og trenge tid til √• starte
        HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 120 "$APP_URL")
        
        if [ "$HTTP_STATUS" -eq 200 ] || [ "$HTTP_STATUS" -eq 302 ]; then
          echo "‚úÖ App er aktiv (HTTP $HTTP_STATUS)"
        elif [ "$HTTP_STATUS" -eq 503 ]; then
          echo "üí§ App sov, venter p√• oppstart..."
          sleep 30
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 120 "$APP_URL")
          echo "üîÑ Nytt fors√∏k: HTTP $HTTP_STATUS"
        else
          echo "‚ö†Ô∏è  App svarte med HTTP $HTTP_STATUS"
        fi
